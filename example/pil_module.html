
<html>
  <head>
    <script src="../dist/skulpt.js" type="text/javascript"></script>
    <script src="../dist/skulpt-stdlib.js" type="text/javascript"></script>
      <!--<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"> </script>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>-->

      <script src="simple_image.js"></script>
        <script src="../src/lib/PIL/__init__.js"></script>
      <script>
          Sk.builtinFiles.files["src/lib/PIL/__init__.js"] = "var $builtinmodule = " + $builtinmodule.toString();
      </script>
      <script src="../src/lib/PIL/Image.js"></script>
      <script>
          Sk.builtinFiles.files["src/lib/PIL/Image.js"] = "var $builtinmodule = " + $builtinmodule.toString();
      </script>
  </head>

  <body>

        <div>
      <div id="website"
          unused-style="border-style: solid; display: block; width: 80%; height: 600px; overflow: scroll; ">
            Loading.
        </div></div>

      <script>
          const target = "#website";
      </script>

    <script>
        Sk.builtinFiles['files']["corgi.png"] = SIMPLE_IMAGE;
        Sk.builtinFiles['files']["corgi2.png"] = MESSY_IMAGE

	function builtinRead(x) {
	    if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
		    throw "File not found: '" + x + "'";
	    return Sk.builtinFiles["files"][x];
	}

    Sk.console = {
        printPILImage: function(data) {
            console.log(data);
            document.body.append(data.image);
        }
    }

    Sk.configure({ read: builtinRead, __future__: Sk.python3,
    output: function () {
      console.log(">>>", ...arguments);
    }});
    Sk.inBrowser = false;

    Sk.fileToURL = function (filename) {
      return filename;
    }

    //Sk.builtinFiles.files["src/lib/gzip.js"] = ``;

    Sk.builtinFiles.files["src/lib/PIL/__init__.js"] = "var $builtinmodule = " + $builtinmodule.toString();
    try {
      Sk.misceval.asyncToPromise(() => Sk.importMainWithBody("main", false, `
from PIL import Image as PIL_Image
import io

print(dir(PIL_Image))
test = PIL_Image.new('RGB', (100, 100), (255, 0, 0))
test.show()
new = b'\\x89PNG\\r\\n\\x1a\\n\\x00\\x00\\x00\\rIHDR\\x00\\x00\\x00d\\x00\\x00\\x00d\\x08\\x02\\x00\\x00\\x00\\xff\\x80\\x02\\x03\\x00\\x00\\x00\\x01sRGB\\x00\\xae\\xce\\x1c\\xe9\\x00\\x00\\x00\\x04gAMA\\x00\\x00\\xb1\\x8f\\x0b\\xfca\\x05\\x00\\x00\\x00\\tpHYs\\x00\\x00\\x0e\\xc3\\x00\\x00\\x0e\\xc3\\x01\\xc7o\\xa8d\\x00\\x00\\x01jIDATx^\\xed\\xd5\\xb1\\r\\xc30\\x0c\\x05Q\\xef\\xbf\\xb4\\x93 \\x0b\\x88\\xc5\\x81\\x10\\xf0\\x1aW\\x04\\xfd%\\x9e\\x8e\\xcf\\xfb\\xbe\\xcf\\xf3\\xf8\\x9e\\xdc\\xc0\\xf7\\xa2\\xdc\\xd4\\xf1\\r\\x9c\\xdc\\xa8\\x9a\\xff\\r kb!\\xd4\\x9c\\xdf\\x00\\xb2\\x90\\xd5l-d!\\x0bY\\xe7&\\xae*\\xab\\xbe\\xcdlw\\xd3r\\x16g5\\\\#\\x0bY\\xc8\\xda\\xb5\\xfb\\xef\\xef\\xfb\\t\\x1a\\n\\x8asq\\x16g5\\xb4"\\x0bY\\xc8*\\x9c=\\xeb9\\xabn&vK\\x06\\xce\\xe2\\xac\\xe6\\x05 \\x0bY\\xc8\\xda\\xdf\\x03\\xfb\\t\\x1a\\n\\x8asq\\x16g5\\xb4"\\x0bY\\xc8*\\x9c=\\xeb9\\xabn&vK\\x06\\xce\\xe2\\xac\\xe6\\x05 \\x0bY\\xc8\\xda\\xdf\\x03\\xfb\\t\\x1a\\n\\x8asq\\x16g5\\xb4"\\x0bY\\xc8*\\x9c=\\xeb9\\xabn&vK\\x06\\xce\\xe2\\xac\\xe6\\x05 \\x0bY\\xc8\\xda\\xdf\\x03\\xfb\\t\\x1a\\n\\x8asq\\x16g5\\xb4"\\x0bY\\xc8*\\x9c=\\xeb9\\xabn&vK\\x06\\xce\\xe2\\xac\\xe6\\x05 \\x0bY\\xc8\\xda\\xdf\\x03\\xfb\\t\\x1a\\n\\x8asq\\x16g5\\xb4"\\x0bY\\xc8*\\x9c=\\xeb9\\xabn&vK\\x06\\xce\\xe2\\xac\\xe6\\x05 \\x0bY\\xc8\\xda\\xdf\\x03\\xfb\\t\\x1a\\n\\x8asq\\x16g5\\xb4"\\x0bY\\xc8*\\x9c=\\xeb9\\xabn&vK\\x06\\xce\\xe2\\xac\\xe6\\x05 \\x0bY\\xc8\\xda\\xdf\\x03\\xfb\\t\\x1a\\n\\x8asq\\x16g5\\xb4"\\x0bY\\xc8*\\x9c=\\xeb9\\xabn&vK\\x06\\xce\\xe2\\xac\\xe6\\x05 \\x0bY\\xc8Z\\xdf\\x03\\x1f\\xd1\\xa4\`\\xcf\\x15\\x87\\xf7\\xa5\\x00\\x00\\x00\\x00IEND\\xaeB\`\\x82'
print(new)
image_bytes = PIL_Image.open(io.BytesIO(new)).convert('RGB')
image_bytes.show()

# Open an image
img = Image.open("corgi.png")

print(img)

print(img.getpixel((0, 0)))

print(img.width)
print(img.height)
print(img.size)
print(img.mode)

width, height = img.size
for x in range(0, width):
    for y in range(0, height):
        r, g, b, a = img.getpixel((x, y))
        img.putpixel((x, y), (255, g, b, a))

img.show()

# save
img.save("corgi2.png")
`, true)
      ).then(result => console.log(result.$d));
    } catch (e) {
      console.error(e);
      console.error(e.args.v[0].v);
    }

    </script>
  </body>
</html>
